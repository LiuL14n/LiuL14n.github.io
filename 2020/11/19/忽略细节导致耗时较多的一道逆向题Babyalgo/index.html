<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=7.1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/xintiao_32.png?v=7.1.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/xintiao_16.png?v=7.1.0"><link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222"><link rel="manifest" href="/images/manifest.json"><meta name="msapplication-config" content="/images/browserconfig.xml"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.1.0",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!0,fancybox:!1,fastclick:!1,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta property="og:type" content="article"><meta property="og:title" content="忽略细节导致耗时较多的一道逆向题Babyalgo"><meta property="og:url" content="http://liul14n.top/2020/11/19/忽略细节导致耗时较多的一道逆向题Babyalgo/index.html"><meta property="og:site_name" content="LiuLian"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/1.jpg"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20201119182531.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20201119183123.png"><meta property="og:updated_time" content="2020-11-19T11:01:56.279Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="忽略细节导致耗时较多的一道逆向题Babyalgo"><meta name="twitter:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/1.jpg"><link rel="canonical" href="http://liul14n.top/2020/11/19/忽略细节导致耗时较多的一道逆向题Babyalgo/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>忽略细节导致耗时较多的一道逆向题Babyalgo | LiuLian</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">LiuLian</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类<span class="badge">8</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档<span class="badge">58</span></a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://liul14n.top/2020/11/19/忽略细节导致耗时较多的一道逆向题Babyalgo/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="LiuLian"><meta itemprop="description" content="Salute The Time"><meta itemprop="image" content="/images/touxiang.jpeg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LiuLian"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">忽略细节导致耗时较多的一道逆向题Babyalgo</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-11-19 18:14:31 / 修改时间：19:01:56" itemprop="dateCreated datePublished" datetime="2020-11-19T18:14:31+08:00">2020-11-19</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/逆向/" itemprop="url" rel="index"><span itemprop="name">逆向</span></a></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数： <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span title="本文字数">21k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">17 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/1.jpg" alt></p><a id="more"></a><h1 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h1><p>早闻Nu1L出了一本《从0到1：CTFer成长之路》</p><p>今天逛BUU的时候发现多了一栏N1BOOK</p><p>点开做一下，发现第二题竟然被卡住了，输出的flag后面有不可见字符而且后五六个字符似乎没啥含义</p><p>折腾挺大一会才发现原来是因为忽略了一个细节…</p><p>耗时比我想象中的多，就当吸取不仔细的教训吧…</p><h1 id="0x01-分析"><a href="#0x01-分析" class="headerlink" title="0x01 分析"></a>0x01 分析</h1><p>来到main函数，可以看到程序定义了一个数组</p><p><strong>但是这里有一个导致我后期输出的flag一直有问题的细节</strong></p><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20201119182531.png" alt></p><p>可以看到…前一个还是<code>[rbp+var_2A]</code>，下一个就变成了<code>[rbp+var_28]</code>，也就是说<code>[rbp+var_29]</code>不见了…</p><p>后期我还纳闷…明明flag要求长度45,但为什么这个数组只有44长度…然后自己在最后补了个0…</p><p>根据常识可知<code>[rbp+var_29] = 0</code></p><p>继续分析，进行了一番变量、函数重命名以后得到如下反汇编结果</p><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20201119183123.png" alt></p><p>这是后来才知道的这个函数是RC4算法函数……</p><p>由于第一次见这个算法的时候没想起来这是RC4，我直接去看相关算法然后逆的</p><p>进去看看RC4函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">RC4</span><span class="params">(__int64 a1, __int64 input, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// ST08_8</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+20h] [rbp-110h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+128h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = a3;</span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_40067A((<span class="keyword">const</span> <span class="keyword">char</span> *)a1, (__int64)&amp;v5);</span><br><span class="line">  sub_400753((__int64)&amp;v5, (<span class="keyword">const</span> <span class="keyword">char</span> *)input, v3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据<code>sub_40067A((const char *)a1, (__int64)&amp;v5);</code>所传入的参数可以知道，这是一个<strong>与我们输入的flag无关的函数</strong>。</p><p>具体分析了一下可以知道它的作用是根据main函数中的key去得到一个数组v5。</p><p>显然可以通过gdb调试(简便)或者自己写个算法(较麻烦,因为如果用python写，还要处理一些数据类型如unsigned int/unsigned __int8等的问题)得到这个数组v5。</p><p>得到的v5会传给<code>sub_400753((__int64)&amp;v5, (const char *)input, v3);</code>函数。</p><p>其作用是生成校验数组v3，也就是a3，也就是RC4的第三个参数RC4output，然后去与main函数中生成的数组进行对比校验，具体操作是通过<strong>一个数</strong>与我们的输入进行异或。</p><p><strong>分析一下，上一句中谈到的”一个数”，是与输入的flag无关的，即无论输入什么flag，只要满足flag.length == 45,在while循环中每次异或时循环次数相同时这个数都是固定不变的，那么可以将这些数(对应xor那句下断,它存在rdx中)提取出来作为一个数组，直接与main函数中的数组异或，便可得到flag。</strong></p><h1 id="0x02-思路"><a href="#0x02-思路" class="headerlink" title="0x02 思路"></a>0x02 思路</h1><h2 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h2><p>由于<code>sub_40067A</code>生成v5数组的过程是与输入无关的,那么可以通过gdb调试或者算法等方法生成v5，然后模拟<code>sub_400753</code>的逆过程生成flag。</p><h2 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h2><p>根据上面的分析，可以将<code>sub_400753</code>中与<code>input[i]</code>异或的那个数提取出来作为数组，与main函数的数组异或即可生成flag。</p><h2 id="思路三"><a href="#思路三" class="headerlink" title="思路三"></a>思路三</h2><p>后来才知道这个是RC4算法，有了密文(main数组即可转换为密文)和key(Nu1Lctf233)，即可生成明文flag。</p><p>不过网上各个RC4算法好像不太一致，在线网站生成结果也不太一样……</p><p>最终找到了一个能用的算法。</p><h1 id="0x03-解密脚本"><a href="#0x03-解密脚本" class="headerlink" title="0x03 解密脚本"></a>0x03 解密脚本</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">根据IDA的显示结果,得到的L是这样的。</span></span><br><span class="line"><span class="string">L = [0xc6,0x21,0xca,0xbf,0x51,0x43,0x37,0x31,</span></span><br><span class="line"><span class="string">     0x75,0xe4,0x8e,0xc0,0x54,0x6f,0x8f,0xee,</span></span><br><span class="line"><span class="string">     0xf8,0x5a,0xa2,0xc1,0xeb,0xa5,0x34,0x6d,</span></span><br><span class="line"><span class="string">     0x71,0x55,0x08,0x07,0xb2,0xa8,0x2f,0xf4,</span></span><br><span class="line"><span class="string">     0x51,0x8e,0x0c,0xcc,0x33,0x53,0x31,0x40,</span></span><br><span class="line"><span class="string">     0xd6,0xca,0xec,0xd4,0x00] #最后的0x00单纯是我为了凑够长度而补的...</span></span><br><span class="line"><span class="string">很可惜这不对,原因在于</span></span><br><span class="line"><span class="string">.text:00000000004009B1                 mov     [rbp+var_2D], 0CCh</span></span><br><span class="line"><span class="string">.text:00000000004009B5                 mov     [rbp+var_2C], 33h</span></span><br><span class="line"><span class="string">.text:00000000004009B9                 mov     [rbp+var_2B], 53h</span></span><br><span class="line"><span class="string">.text:00000000004009BD                 mov     [rbp+var_2A], 31h  #注意这里, 下一行直接是var_28,少了var_29</span></span><br><span class="line"><span class="string">.text:00000000004009C1                 mov     [rbp+var_28], 40h  #也即默认[rbp+var_29] = 0,并且以下都有一位移位</span></span><br><span class="line"><span class="string">.text:00000000004009C5                 mov     [rbp+var_27], 0D6h</span></span><br><span class="line"><span class="string">.text:00000000004009C9                 mov     [rbp+var_26], 0CAh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">通过gdb调试或者正确分析了以后可以知道真正的L是这样的</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">L = [<span class="number">0xc6</span>,<span class="number">0x21</span>,<span class="number">0xca</span>,<span class="number">0xbf</span>,<span class="number">0x51</span>,<span class="number">0x43</span>,<span class="number">0x37</span>,<span class="number">0x31</span>,</span><br><span class="line">     <span class="number">0x75</span>,<span class="number">0xe4</span>,<span class="number">0x8e</span>,<span class="number">0xc0</span>,<span class="number">0x54</span>,<span class="number">0x6f</span>,<span class="number">0x8f</span>,<span class="number">0xee</span>,</span><br><span class="line">     <span class="number">0xf8</span>,<span class="number">0x5a</span>,<span class="number">0xa2</span>,<span class="number">0xc1</span>,<span class="number">0xeb</span>,<span class="number">0xa5</span>,<span class="number">0x34</span>,<span class="number">0x6d</span>,</span><br><span class="line">     <span class="number">0x71</span>,<span class="number">0x55</span>,<span class="number">0x08</span>,<span class="number">0x07</span>,<span class="number">0xb2</span>,<span class="number">0xa8</span>,<span class="number">0x2f</span>,<span class="number">0xf4</span>,</span><br><span class="line">     <span class="number">0x51</span>,<span class="number">0x8e</span>,<span class="number">0x0c</span>,<span class="number">0xcc</span>,<span class="number">0x33</span>,<span class="number">0x53</span>,<span class="number">0x31</span>,<span class="number">0x00</span>,</span><br><span class="line">     <span class="number">0x40</span>,<span class="number">0xd6</span>,<span class="number">0xca</span>,<span class="number">0xec</span>,<span class="number">0xd4</span>,]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">思路1:似乎略微麻烦一些</span></span><br><span class="line"><span class="string">gdb调试拿到sub_40067A的结果的第二个参数,即下方s</span></span><br><span class="line"><span class="string">然后模拟执行sub_400753</span></span><br><span class="line"><span class="string">其中异或过程为逆向过程</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">s = <span class="string">'0x4e	0xc4	0xf7	0x68	0x09	0x26	0x08	0x0e	0x92	0x2d	0x9a	0x1a	0x64	0xb0	0x21	0xa4	0x0b	0x5d	0xa2	0x22	0x4a	0xd4	0x1b	0x7e	0xfb	0x76	0x80	0x55	0x32	0x27	0x4f	0x1d	0xf8	0x8e	0x88	0x0f	0x5a	0x69	0xe6	0xb4	0x2f	0x9c	0x8c	0x89	0x36	0x11	0x38	0x8d	0x25	0xe7	0xcd	0x42	0x87	0xdf	0x78	0x4c	0x5f	0x9f	0x99	0xa3	0xcf	0xa1	0xb2	0xd0	0x9b	0x47	0x6a	0xd1	0xbc	0x5e	0x85	0x13	0x59	0x1e	0xc6	0x2c	0x52	0xb6	0x4b	0x65	0x2b	0x40	0xaa	0xeb	0x96	0x75	0x41	0x49	0xf0	0x10	0x6d	0xf4	0x81	0xde	0x0c	0xab	0x0d	0x5b	0xc3	0xd2	0xe5	0x90	0xc0	0x66	0x29	0x01	0x94	0x44	0x48	0x20	0x57	0x98	0x61	0x83	0x8f	0x15	0xae	0x28	0xef	0xa8	0x39	0xd7	0xc5	0x2a	0xba	0xec	0x4d	0x93	0x79	0xa9	0xfc	0xe9	0xbb	0xbd	0xaf	0x45	0xe8	0xdd	0x0a	0xdc	0x04	0xc8	0xca	0xe2	0xd5	0xb9	0x03	0x00	0xad	0xa7	0x8a	0x6c	0x58	0xf5	0xee	0x30	0xff	0xbe	0x7f	0x19	0x56	0x54	0xc2	0xf3	0x72	0xbf	0x63	0x17	0xfa	0x9d	0x77	0xd3	0x91	0x14	0x35	0x7d	0x18	0xb7	0x23	0x8b	0xa0	0xda	0x05	0x7b	0xe1	0x7a	0xa6	0x62	0x71	0xcc	0xd8	0x6b	0x9e	0xf6	0x3f	0x1f	0xb3	0x2e	0x5c	0x12	0x1c	0x3a	0x6f	0x73	0xf1	0x67	0xcb	0xac	0x3e	0x07	0x74	0xc1	0x86	0x51	0xc7	0x82	0xce	0x43	0xe4	0xe3	0xed	0x53	0x33	0x16	0xb5	0x06	0x37	0xdb	0xc9	0xf2	0x84	0x50	0x95	0xa5	0xd6	0x46	0xb8	0xfd	0x70	0x60	0x24	0x97	0x6e	0xb1	0x3c	0x02	0xea	0x3b	0x34	0xfe	0xd9	0xf9	0x7c	0xe0	0x3d	0x31'</span></span><br><span class="line">Li = s.split(<span class="string">'\t'</span>)</span><br><span class="line">v5 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> Li:</span><br><span class="line">    v5.append(int(i,<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">v6 = <span class="number">0</span></span><br><span class="line">v7 = <span class="number">0</span></span><br><span class="line">v8 = <span class="number">0</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这是模拟sub_400753,其中异或为逆向过程</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">45</span>):</span><br><span class="line">    v6 = ((((((v6+<span class="number">1</span>)&gt;&gt;<span class="number">31</span>)&amp;<span class="number">0xffffffff</span>)&gt;&gt;<span class="number">24</span>) + v6 + <span class="number">1</span>)&amp;<span class="number">0xff</span>) - ((((v6+<span class="number">1</span>)&gt;&gt;<span class="number">31</span>)&amp;<span class="number">0xffffffff</span>)&gt;&gt;<span class="number">24</span>)</span><br><span class="line">    v3 = (((v7+(v5[v6]&amp;<span class="number">0xff</span>))&gt;&gt;<span class="number">31</span>)&amp;<span class="number">0xffffffff</span>)&gt;&gt;<span class="number">24</span></span><br><span class="line">    v7 = (v3+v7 + v5[v6])&amp;<span class="number">0xff</span> - v3</span><br><span class="line">    v5[v6],v5[v7] = v5[v7],v5[v6]</span><br><span class="line">    tmp = v5[((v5[v6] + v5[v7])&amp;<span class="number">0xff</span>)]&amp;<span class="number">0xff</span></span><br><span class="line">    flag += chr(L[i]^tmp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">思路2:</span></span><br><span class="line"><span class="string">由于不论输入的flag是什么,只要满足输入长度=45,在sub_400753中input[i] ^ 某个数中这个某个数都是不变的</span></span><br><span class="line"><span class="string">固可以通过gdb调试，下断，依次读取其值(存在edx中),就能得到一个数组,然后去与我们的L进行异或</span></span><br><span class="line"><span class="string">即可得到flag</span></span><br><span class="line"><span class="string">得到的数组如下:</span></span><br><span class="line"><span class="string">这个方法算是思路1的进阶版吧,虽然也有点麻烦,但是对于应对一些算法比较晦涩难懂的情况还是很好用的</span></span><br><span class="line"><span class="string">(当然这个题算法....emmmm做完才知道是RC4....可以直接解密)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">ano = [<span class="number">0xa8</span>,<span class="number">0x10</span>,<span class="number">0xa8</span>,<span class="number">0xd0</span>,<span class="number">0x3e</span>,<span class="number">0x28</span>,<span class="number">0x4c</span>,<span class="number">0x44</span>,</span><br><span class="line">       <span class="number">0x06</span>,<span class="number">0xd5</span>,<span class="number">0xe0</span>,<span class="number">0x87</span>,<span class="number">0x0b</span>,<span class="number">0x09</span>,<span class="number">0xbc</span>,<span class="number">0x8f</span>,</span><br><span class="line">       <span class="number">0x8c</span>,<span class="number">0x2f</span>,<span class="number">0xd0</span>,<span class="number">0xf2</span>,<span class="number">0x98</span>,<span class="number">0xfa</span>,<span class="number">0x03</span>,<span class="number">0x02</span>,</span><br><span class="line">       <span class="number">0x2e</span>,<span class="number">0x31</span>,<span class="number">0x6d</span>,<span class="number">0x30</span>,<span class="number">0xd7</span>,<span class="number">0xda</span>,<span class="number">0x42</span>,<span class="number">0xc5</span>,</span><br><span class="line">       <span class="number">0x3f</span>,<span class="number">0xbd</span>,<span class="number">0x53</span>,<span class="number">0xf8</span>,<span class="number">0x5f</span>,<span class="number">0x34</span>,<span class="number">0x01</span>,<span class="number">0x72</span>,</span><br><span class="line">       <span class="number">0x29</span>,<span class="number">0xe1</span>,<span class="number">0xa2</span>,<span class="number">0x81</span>,<span class="number">0xa9</span>]</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ano)):</span><br><span class="line">    flag += chr(ano[i]^L[i])</span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">思路3:</span></span><br><span class="line"><span class="string">直接利用RC4解密</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4 <span class="keyword">as</span> rc4cipher</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_algorithm</span><span class="params">(encrypt_or_decrypt, data, key1)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> encrypt_or_decrypt == <span class="string">"encrypt"</span>:</span><br><span class="line">        key = bytes(key1)</span><br><span class="line">        enc = rc4cipher.new(key)</span><br><span class="line">        res = enc.encrypt(data.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">        res=base64.b64encode(res)</span><br><span class="line">        res = str(res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">elif</span> encrypt_or_decrypt == <span class="string">"decrypt"</span>:</span><br><span class="line">        data = base64.b64decode(data)</span><br><span class="line">        key = bytes(key1)</span><br><span class="line">        enc = rc4cipher.new(key)</span><br><span class="line">        res = enc.decrypt(data)</span><br><span class="line">        res = str(res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">'Nu1Lctf233'</span></span><br><span class="line">text = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> L:</span><br><span class="line">    text += chr(i)</span><br><span class="line">res = base64.b64encode(text)</span><br><span class="line"><span class="keyword">print</span> rc4_algorithm(<span class="string">'decrypt'</span>, res, key)</span><br></pre></td></tr></table></figure><h1 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h1><p>细节很重要。</p><p>熟记各种常见算法会对逆向很有帮助。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------至此本文结束<i class="fa fa-tree"></i>感谢您的阅读-------------</div></div></div><div><div id="reward-container"><div>如果觉得这篇文章对您有用，请随意打赏。 (๑•⌄•๑) 您的支持将鼓励我继续创作！</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/Wechat_SKM.png" alt="LiuLian 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/ZFB_SKM.png" alt="LiuLian 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>LiuLian</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://liul14n.top/2020/11/19/忽略细节导致耗时较多的一道逆向题Babyalgo/" title="忽略细节导致耗时较多的一道逆向题Babyalgo">http://liul14n.top/2020/11/19/忽略细节导致耗时较多的一道逆向题Babyalgo/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2020/09/23/mrctf2020-shellcode-revenge/" rel="next" title="mrctf2020_shellcode_revenge"><i class="fa fa-chevron-left"></i> mrctf2020_shellcode_revenge</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2020/11/24/Base64-changed-一道比赛逆向题/" rel="prev" title="Base64_changed(一道比赛逆向题)">Base64_changed(一道比赛逆向题) <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/touxiang.jpeg" alt="LiuLian"><p class="site-author-name" itemprop="name">LiuLian</p><div class="site-description motion-element" itemprop="description">Salute The Time</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">58</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/LiuL14n" title="GitHub &rarr; https://github.com/LiuL14n" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=aFlZWl1aWVxcWVEoGRlGCwcF" title="E-Mail &rarr; http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=aFlZWl1aWVxcWVEoGRlGCwcF" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="http://wpa.qq.com/msgrd?v=3&uin=1125214419&site=qq&menu=yes" title="QQ &rarr; http://wpa.qq.com/msgrd?v=3&uin=1125214419&site=qq&menu=yes" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QQ</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> From 大佬 import&nbsp; <i class="fa fa-fw fa-link"></i></div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://suxinghe39.github.io/" title="SuXingHe" target="_blank">SuXingHe</a></li><li class="links-of-blogroll-item"><a href="https://hal900000.github.io" title="Hal90000" target="_blank">Hal90000</a></li><li class="links-of-blogroll-item"><a href="http://n4tsu.top/" title="Natsu" target="_blank">Natsu</a></li><li class="links-of-blogroll-item"><a href="https://dililidala.github.io" title="Ohrxw" target="_blank">Ohrxw</a></li><li class="links-of-blogroll-item"><a href="http://www.wendev.site" title="JiangWen" target="_blank">JiangWen</a></li><li class="links-of-blogroll-item"><a href="https://l0ne1y.xyz/" title="L0ne1y" target="_blank">L0ne1y</a></li></ul><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("04/25/2019 21:13:14"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00-前言"><span class="nav-number">1.</span> <span class="nav-text">0x00 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-分析"><span class="nav-number">2.</span> <span class="nav-text">0x01 分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-思路"><span class="nav-number">3.</span> <span class="nav-text">0x02 思路</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#思路一"><span class="nav-number">3.1.</span> <span class="nav-text">思路一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#思路二"><span class="nav-number">3.2.</span> <span class="nav-text">思路二</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#思路三"><span class="nav-number">3.3.</span> <span class="nav-text">思路三</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-解密脚本"><span class="nav-number">4.</span> <span class="nav-text">0x03 解密脚本</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-总结"><span class="nav-number">5.</span> <span class="nav-text">0x04 总结</span></a></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2022</span> <span class="with-love" id="animate"><i class="fa fa-star"></i> </span><span class="author" itemprop="copyrightHolder">LiuLian</span></div><div class="powered-by"><i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv"> 本站访客数:<span id="busuanzi_value_site_pv"></span></span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-s"></i> </span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="255,105,180" opacity="0.6" zindex="-1" count="77" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.1.0"></script><script src="/js/motion.js?v=7.1.0"></script><script src="/js/affix.js?v=7.1.0"></script><script src="/js/schemes/pisces.js?v=7.1.0"></script><script src="/js/scrollspy.js?v=7.1.0"></script><script src="/js/post-details.js?v=7.1.0"></script><script src="/js/next-boot.js?v=7.1.0"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=window.pageYOffset||document.documentElement.scrollTop;n.style.top=o+"px",n.style.position="absolute",n.style.opacity="0",n.readOnly=!0,n.value=t,document.body.appendChild(n),n.select(),n.setSelectionRange(0,t.length),n.readOnly=!1;document.execCommand("copy");n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("复制")},300)}).append(t)})</script><script type="text/javascript" color="0,191,255" opacity="1" zindex="-2" count="60" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/clicklove.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/z16.model.json"},display:{position:"right",width:210,height:420},mobile:{show:!0},log:!1})</script></body></html>